rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========================================
    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    // ========================================
    
    // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ãƒã‚§ãƒƒã‚¯
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‹ãƒã‚§ãƒƒã‚¯
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    // ========================================
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£
    // ========================================
    
    match /users/{userId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¨å“¡èª­ã‚ã‚‹ï¼ˆæ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªã®ãŸã‚ï¼‰
      allow read: if isAuthenticated();
      
      // ä½œæˆ: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆè‡ªåˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ï¼‰
      allow create: if isAuthenticated() && isOwner(userId);
      
      // æ›´æ–°: è‡ªåˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿
      allow update: if isAuthenticated() && isOwner(userId);
      
      // å‰Šé™¤: è‡ªåˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿
      allow delete: if isAuthenticated() && isOwner(userId);
    }
    
    // ========================================
    // æ±‚è·è€…æƒ…å ±ï¼ˆå€‹äººæƒ…å ±ï¼‰ğŸ”´ æœ€é‡è¦
    // ========================================
    
    match /candidates/{candidateId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ï¼ˆæ‰¿èªãƒã‚§ãƒƒã‚¯ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§å®Ÿæ–½ï¼‰
      allow read: if isAuthenticated();
      
      // ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow create, update, delete: if isAuthenticated();
    }
    
    // ========================================
    // ä¼æ¥­æƒ…å ±
    // ========================================
    
    match /companies/{companyId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow read: if isAuthenticated();
      
      // ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow create, update, delete: if isAuthenticated();
    }
    
    // ========================================
    // åº—èˆ—æƒ…å ±
    // ========================================
    
    match /stores/{storeId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow read: if isAuthenticated();
      
      // ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow create, update, delete: if isAuthenticated();
    }
    
    // ========================================
    // æ±‚äººæƒ…å ±
    // ========================================
    
    match /jobs/{jobId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow read: if isAuthenticated();
      
      // ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow create, update, delete: if isAuthenticated();
    }
    
    // ========================================
    // ãƒãƒƒãƒãƒ³ã‚°æƒ…å ±
    // ========================================
    
    match /matches/{matchId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow read: if isAuthenticated();
      
      // ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow create, update, delete: if isAuthenticated();
    }
    
    // ========================================
    // é€²æ—ç®¡ç†
    // ========================================
    
    match /progress/{progressId} {
      // èª­ã¿å–ã‚Š: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow read: if isAuthenticated();
      
      // ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
      allow create, update, delete: if isAuthenticated();
    }
    
    // ========================================
    // APIç®¡ç†ï¼ˆAdmin SDKã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
    // ========================================
    
    match /apiKeys/{keyId} {
      // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã¯ä¸€åˆ‡ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
      allow read, write: if false;
    }
    
    match /apiRateLimits/{limitId} {
      // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã¯ä¸€åˆ‡ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
      allow read, write: if false;
    }
    
    // ========================================
    // æ±‚è·è€…èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
    // ========================================
    
    match /candidateAuthTokens/{tokenId} {
      // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã¯ä¸€åˆ‡ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
      allow read, write: if false;
    }
    
    // ========================================
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã™ã¹ã¦æ‹’å¦
    // ========================================
    
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
